# 測試計畫 (Test Plan)

## 1. 目標
驗證 C2C 平台之功能與品質，確保用戶/商品/購物車/訂單/支付/評價/交易鎖等模組符合 SRS 與設計。

## 2. 測試層級
- 單元測試：Service、Repository、狀態機、鎖管理、例外處理。
- 整合測試：下單→支付→狀態更新→評價完整流程；錯誤情境（餘額不足、庫存不足、鎖超時）。
- 系統/黑箱：依 CLI 用例腳本驗證主要功能。
- 白箱：覆蓋核心分支（支付成功/失敗、庫存邊界、狀態流轉非法路徑）。

## 3. 工具與度量
- JUnit 5：測試框架。
- Mockito：mock BankService/Repository，以控制支付結果。
- JaCoCo：覆蓋率報告，目標：行/分支 ≥ 90%，核心支付/訂單 ≥ 90%。
- PMD：靜態檢查；MetricsReloaded：程式碼度量。

## 4. 測試資料與前置條件
- 測試帳號：buyerA, sellerB（預設餘額、商品庫存）。
- 測試商品：商品1（庫存 5）、商品2（庫存 1）、已下架商品。
- 支付：可用卡號/餘額充足與不足、鎖定超時模擬。

## 5. 關鍵測試案例（示意）
- 用戶
  - 註冊成功/重複 email/phone 失敗；登入成功/密碼錯誤失敗。
- 商品
  - 上架/下架/編輯；搜尋排序（關鍵字、類別、價格）；庫存不足時拒絕加入購物車。
- 購物車
  - 加入、更新數量、刪除；計算合計；跨賣家商品同時存在。
- 訂單
  - 從購物車建立訂單；直接購買；無庫存/下架時失敗；狀態機非法流轉被拒。
- 支付/銀行
  - 成功扣款；餘額不足；鎖超時；扣款失敗後庫存回復，訂單狀態回到 CANCELED。
- 評價
  - 已完成訂單才能評價；評分範圍檢查；平均分數計算。
- 日誌/例外
  - 觸發例外時寫入 log，CLI 仍回友善訊息。

## 6. 測試流程
1) 建立測試資料（BeforeEach 或 TestFixture）。
2) 執行單元測試；檢查結果與例外。
3) 執行整合測試腳本；驗證狀態流轉與日誌。
4) 生成 JaCoCo 報告；若低於門檻，補充測試。
5) 執行 PMD；修正告警。

## 7. 交付物
- 測試案例文件（對應用例）。
- 測試程式碼與 JaCoCo 報告。
- PMD 報告與修正紀錄。
